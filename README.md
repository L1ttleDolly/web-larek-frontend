# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных используемых в приложении

**Интерфейс Form**\
Используется для типизации и базового класса **Form**

```
interface IFormState {
	valid: boolean;
	errors: string[];
	content: HTMLTemplateElement;
	isPayMethod: boolean;
	validation?: { valid: boolean; errors: Record<string, string> };
	reset(): void;
}
```
**Интерфейс Modal**\
Для типизации котентанта, который будет вставляться в **Modal** через **render**.\
Метод **render** наследуется от **Component**
```
interface IModalData {
	content: HTMLElement;
}
```

**Интерфейс данных пользователя**\
Используется для хранения данных пользователя в формах,
в форме оплаты или контактной информации.

```
export interface IUserData {
	payment: 'card' | 'cash';
	email: string;
	phone: string;
	address: string;
}
```

**Интерфейс описания товара**\
Используется для описания товара в каталоге, отображаемого на странице.

```
export interface IProduct { //карточка товара
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

**Интерфейс каталога всех товаров**\
содержит массив товаров и информацию о превью, используется для отображения всех товаров на главной странице, проверяет полученные с сервера данные

```
export interface IProductsData { 
	items: IProduct[];
	preview: string | null;
	total: number;
}
```
**Интерфейс данных корзины BasketData**\
Описывает в себе методы, которые используются внутри класса, 
для взаимодействия с данными корзины

```
export interface IUserBasket {
	addItem(item: IProduct): void;
	deleteItem(cardId: string): void; 
	clearBasket(): void;
	getItemsList(): TBasketItem[];
	checkedAllItems?(): IProduct;
	isInBasket(product: IProduct): boolean
	getTotal(): number
}
```

**Интерфейс класса данных каталога карточек товара на главной странице IProductsModel**
Описывает в себе методы, для работы с данными каталога карточек товара
```
interface IProductsModel {
	setProducts(products: IProduct[]): void;
	getProductById(id: string): IProduct | undefined;
	getCatalog(): IProduct[];
}
```

**Интерфейс класса данных пользователя UserModel**
Описывает в себе методы, для сохранения и проверки данных пользователя
```
interface IUserModel {
	setField<T extends keyof IUserData>(field: T, value: IUserData[T]): void;
	validateAll(): {valid: boolean};
	resetData(): void;
	getUserData(): IUserData;
}
```

**Интерфейс класса представления корзины BasketView**
Содержит в себе свойства, сеттеры и методы, для отображения и перерисовки корзины
```
interface IBasketView {
	items: HTMLElement[];
	total: number;
	totalPrice: number | null;
	renderItemList: HTMLElement[];
	updateButtonState: number;
	button: HTMLButtonElement;
}
```

**Интерфейс базового класса представления для карточек - Card**
Содержит в себе все описанные свойста Интерфейса IProduct, и дополнительные для типизации сеттеров дочерних классов
```
interface ICard extends IProduct {
	buttonText: string;
	index: number;
	TotalPrice: number;
}
```

**Интерфейс дочернего класса представления FormContacts**
Содержит в себе свойста инпуты формы контактов, для установки слушателя и получения field и value.
```
interface IContactsOrder {
	email: string;
	phone: string;
}
```
**Интерфейс дочернего класса представления IFormOrder**
Содержит в себе свойста инпуты формы заказа, для установки слушателя и получения field и value.
```
interface IFormOrder {
	payment: 'card' | 'cash';
	address: string;
}
```

**Интерфейс класса представления Gallery**
Содержит в себе типизацию контейнера для карточек товара
```
export interface IGalleryData {
	catalog: HTMLElement[];
}
```

**Интерфейс класса представления Header**
Содержит в себе типизацию счетчика корзины
```
export interface IHeaderData {
	counter: number;
}
```

**Интерфейс класса представления Success**
Содержит в себе типизацию отображения общей суммы заказа
```
interface ISuccess {
	totalPrice: number;
}
```

**Интерфейс ответа сервера**
Содержит в себе поля, которыми отвечает сервер, после успешной отправки заказа на сервер
```
interface IOrderResult {
	id: string;
	total: number;
}
```

**Тип способа оплаты**   
Определяет возможные способы оплаты товара

```
export type TPaymentMethod = 'online' | 'on_delivery' | null;
```
**Тип данных используемых в корзине для списка товаров**

```
export type  TBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```

## Архитектура приложения

Код приложения сделан в парадигме MVP:
- Слой данных, отвечает за хранение и изменение данными.
- Слой представления, отвечает за отображение данных на странице.
- Презентер отвечает за связь между слоем данных и слоем представления,
управляет состоянием и логикой взаимодействия между данными и UI.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов.  

В конструктор передается базовый адрес страницы `baseUrl: string,` -
но задается при создании экземпляра класса и не может быть изменено,
так как он имеет модификатор `readonly`.

Опциональный объект с заголовками запросов `options: RequestInit = {}` -
хранит настройки для HTTP-запросов, такие как заголовки, метод, тело запроса и другие параметры.
Это свойство используется для настройки всех запросов через методы `get` и `post`.

Конструктор `constructor(baseUrl: string, options: RequestInit = {})` -
инициализирует экземпляр класса, устанавливая базовый URL для запросов и настройки,
которые можно передать для конфигурации HTTP-запросов.

**Методы:**

- `get` - Выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - Принимает объект с данными, которые будут переданы в JSON в теле запроса,
и отправляет эти данные на ендпоинт переданный как параметр при вызове метода.
По умолчанию выполняется `POST` запрос,
но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - Метод для обработки ответа от сервера, в случае успешного ответа, метод возвращает данные в формате JSON.
В случае ошибки, метод отклоняет промис с ошибкой, содержащей текст ошибки или статусный текст.

### Класс EventEmitter

Используется для обработки событий, инициируя связь между данными и UI.\
С помощью событий, приложение реагирует на действия пользователя, что приводит к обновлению представления.\
Этот интерфейс описывает методы, которые должен реализовывать любой класс, работающий с событиями:`IEvents`:
- `on` - Подписывает обработчик на событие. Если для события ещё нет подписчиков, создается новый набор для этого события.
- `emit` - Инициирует событие и вызывает все подписанные на него обработчики.
- `trigger` - Метод для создания триггер-функции, которая будет генерировать событие при вызове.

### Слой данных
Отвечает за работу с данными, обеспечивает их хранение и обработку информации,
предоставляет данные через методы классов.


#### Класс BasketData
Класс отвечает за работу данных связанных с корзиной
Конструктор класса `UserBasket` принимает экземпляр `EventEmitter`,
который необходим для инициирования события обновления корзины

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- addItem(item: IProduct): void; - Добавляет один товар в корзину.
- deleteItem(cardId: string): void; - Удаляет один товар из корзины.
- clearBasket(): void; - Удаляет все товары из корзины после отправки заказа на сервер.
- isInBasket(product: IProduct): boolean - Проверяет на наличие товара в корзине.
- getItemsList(): TBasketItem[]; - Получение списка всех товаров находящихся в корзине.
- getTotalCount(): number; - Получение количества всех товаров находящихся в корзине.
- getTotal(): number - Получение общей суммы всех товаров находящихся в корзине.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

#### Класс ProductsModel
Класс отвечает за работу данных связанных с отображаемым массивом карточек на странице
Конструктор класса принимает инстант брокера событий

- setProducts(item: IProduct): void; - Заполняет контейнер карточками
- getCatalog(): IProductsData; - Метод получения всех карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

#### Класс UserModel
Класс отвечает за хранение и проверку данных пользователя
Конструктор принимает инстант брокера событий

- setField<T extends keyof IUserData>(field: T, value: IUserData[T]) - метод для сохранения данных
- validateAll() - метод для валидации всех вводимых данных пользователем в формы.
- resetData() - метод для сброса валидации всех форм.
- getUserData() - метод для получения данных пользователя.

### Слой представления
Содержит все классы, отвечающие за отображение данных в интерфейсе пользователя,
управляет элементами UI и отображает эти данные в DOM-элементах


#### Базовый Класс Component
Является абстрактным базовым классом для компонентов
пользовательского интерфейса, которые могут быть отрисованы на странице.
Он принимает в конструкторе контейнер, в который будет отрендерены элементы.
Класс позволяет удобно обновлять данные компонента и рендерить его заново.

`container: HTMLElement` - это свойство хранит контейнер (HTML-элемент), в который будет отрисовываться компонент.
При создании компонента передается как аргумент в конструктор.

`constructor(container: HTMLElement)` - конструктор класса принимает HTML-элемент,
который будет использоваться как контейнер для компонента.
Все дочерние элементы компонента будут добавлены в этот контейнер.

`render(data?: Partial<T>): HTMLElement` - метод рендерит компонент и возвращает его в виде HTML-элемента.
Метод также позволяет обновить данные компонента через параметр data.
Если данные не переданы, используется текущее состояние компонента.

### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления состоянием модального окна. 
Имеет метод render от родителя, для установки нового контента в модальное окно
- constructor(container: HTMLElement, protected events: IEvents) Конструктор принимает контейнер, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
protected closeButton: HTMLButtonElement; - кнопка закрытия модального окна
protected contentModal: HTMLElement; - содержимое модального окна


### Класс Form
Класс, представляющий сеттеры для изменения состояния кнопки и отображения или очистки ошибок.
Отвечает за управление состоянием формы, валидацию и вывод ошибок.\
Также предоставляет сеттеры для работы с состоянием формы:\
- set valid(value: boolean) - Сеттер для изменения состояния кнопки.
- set errors(value: string) - Сеттер для вывода ошибок.
- reset(): void - Метод для очистки форм.

#### Класс FormContacts
Дочерний класс `Form`, для формы, содержащей информацию о контактных данных пользователя.\
Включает в себя поля для email и телефона пользователя.\
Обеспечивает отображение валидации и ошибок для контактных данных.
Так же имеет слушатели полей формы.

#### Класс FormOrder
Дочерний класс `Form`, содержащий информацию о заказе пользователя.\
Включает в себя поля для адреса и способа оплаты пользователя.\
Обеспечивает отображение валидации и ошибок для заказа.
Так же имеет слушатели полей формы.

### Класс  Gallery
Класс для работы с контейнером главной страницы.\
Отвечает за отображение всех карточек товаров в контейнере
Имеет метод `setCatalog` для добавления элементов галереи в контейнер.

### Класс Header
Класс для отображения в шапке страницы корзины с счетчиком товаров, которые находятся в корзине.\
Наследуется от компонента и отображает информацию о количестве товаров в корзине.\
Принимает в конструктор `(container: HTMLElement, events: IEvents)`\
- Сеттер `counter` для установки значения счётчика в корзине.
- Сеттер `locked` для блокировки скролла страницы, при открытом модальном окне.

### Класс Card 
Базовый класс карточки товара.
Принимает в конструктор `(container: HTMLElement, events: IEvents)`\
Содержит в себе сеттеры для все общих свойст разных видов карточек.\
- Сеттер `title` для отображения информации о карточке товара.
- Сеттер `price` для отображения цены товара

#### Класс CardCatalog
Дочерний класс `Card`, для карточки товара в каталоге,\
Принимает в конструктор `(container: HTMLElement, protected events: IEvents)`\
Содержит в себе сеттеры для отображения свойств карточки товара главной страницы\
- Сеттер `image` для отображения картинки товара.
- Сеттер `category` для отображения категории товара\
Остальные сеттер наследует от Card

#### Класс CardBasket
Дочерний класс `Card`, для карточки товара в корзине,\
Принимает в конструктор `(container: HTMLElement, protected events: IEvents)`\
Содержит в себе сеттеры для отображения свойст карточки корзины.\
- Сеттер `title` - для отображения названия товара.
- Сеттер `index` - для отображения порядкового номера в корзине.\
Остальные сеттер наследует от Card


#### Класс CardModal
Дочерний класс `Card`, для карточки товара в модальном окне,\
Принимает в конструктор `(container: HTMLElement, protected events: IEvents)`\
Содержит в себе сеттеры для отображения свойст карточки просмотра.\
- Сеттер `description` - для отображения описания товара.
- Сеттер `image` - для отображения картинки товара.
- Сеттер `category` - для отображения категории товара.
- Сеттер `buttonText` - для перерисовки текста кнопки в модальном окне
- Сеттер `price` - измененной сеттер для родителя, для изменения состояния кнопки

#### Класс Success
Дочерний класс `Compinent`, для отображения окна об успешной отправки заказа.
Принимает в конструктор `(container: HTMLElement, protected events: IEvents)`\
Содержит в себе сеттер для отображения общей суммы заказа\
- Сеттер `totalPrice` - отображает общую сумму заказа.

### Слой коммуникации
Реализует взаимодействие между слоями данных и представления через события,
инициируемые классами типа `EventEmitter`.
Через эти события соединяет логику работы с данными и отображение,
реагируя на действия пользователя.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Список всех событий, которые могут генерироваться в системе:

*События изменения данных (генерируются классами моделями данных)*

- `basket:updated` - изменение состояния корзины
- `products:changed` - изменение продукта

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `basket-submit:next` - нажатие на кнопку для начала оформления заказа
- `form-order:next` - нажатие на кнопку в форме заказа, для перехода к следующей формы
- `form-contacts:send-order` - нажатие на кнопку в форме контактов, которая отправляет заказа на сервер
- `success:close` - закрытие окна подтверждающего успешно оформленный заказ
- `basket-card:delete` - нажатие на кнопку удаления товара из корзины
- `product:select` - выбор карточки в каталоге для открытия в окне просмотра
- `modal-card:toggle-product` - переключения кнопки в окне просмотра карточки(купить \ удалить из корзины)
- `basket:open` - нажатие на корзину в шапке главной страницы, открывает корзину
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна